<include file="Public/top" title="里程密-网站配置"/>
<link href="__PUBLIC__/Default/jquery-upload-file/css/uploadfile.css" rel="stylesheet">
<link href="__PUBLIC__/Default/jquery-upload-file/css/uploadfile.custom.css" rel="stylesheet">

<!-- start left -->
<include file="Public/left"/>
<!-- end left -->
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>图片上传</h2>
    </div>
    <div class="col-lg-2">

    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <!-- <h5>All form elements <small>With custom checbox and radion elements.</small></h5> -->
                <div class="ibox-tools">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-wrench"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#">Config option 1</a>
                        </li>
                        <li><a href="#">Config option 2</a>
                        </li>
                    </ul>
                    <a class="close-link">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
            </div>
            <div class="ibox-content">
                <form method="post" class="form-horizontal" action="{:U('Images/upload_base',array('id'=>$base['id']))}"
                      enctype="multipart/form-data">

                    <div class="form-group has-success"><label class="col-sm-2 control-label">说明</label>
                        <div class="col-sm-8"><input name="title" class="form-control" value="{$base.title}"></div>
                    </div>

                    <div class="form-group has-success">
                        <label class="col-sm-2 control-label">图片 (550px * 400px)</label>
                        <div class="col-sm-4">
                            <div id="fileuploader">上传</div>
                        </div>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" name="pic" required
                                   value="{$base.pic}" id="product_pic">
                            <div style="height: 170px;width: 100%;padding: 15px;"><img src="{$base.pic}" height="200px;"></div>
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>
                    <div class="ibox-content">
                        <div class="text-center">
                            <input type="submit" value="保存" class="btn btn-primary" data-toggle="modal">
                            <a class="btn btn-default" href="{:U('Images/base')}">返回</a>
                        </div>

                    </div>
                </form>
            </div>
        </div>

    </div>
    <!-- start footer -->
    <include file="Public/footer"/>
    <script src="__PUBLIC__/Default/jquery-upload-file/js/jquery.form.js"></script>
    <script src="__PUBLIC__/Default/jquery-upload-file/js/jquery.uploadfile.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#fileuploader").uploadFile({
                url: "{:U('Site/upload_logo')}", //上传URL
                fileName: "product_pic", //名称
                maxFileCount: 1, //上传文件数量
                acceptFiles: "image/*", //类型
                formData: {name: "product_pic"}, //通过FROM传过去的参数
                onSuccess: function (files, data, xhr, pd) {
                    if (data.success) {
                        $(".ajax-file-upload-filename:contains(" + files + ")").after('<div style = "color:red;">上传成功</div>');
                        $("#product_pic").val(data.file_path);
                    } else {

                    }
                },
                onError: function (files, status, errMsg, pd) {
                    $(".ajax-file-upload-filename:contains(" + files + ")").after('<div style = "color:red;">上传失败</div>');
                    alert('上传失败请检查,错误提示：' + errMsg);
                }
            });
        });
    </script>
    <!-- end footer -->
</div>
</script>
